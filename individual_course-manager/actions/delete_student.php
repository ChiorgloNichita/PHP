<?php
/**
 * Удаление студента из базы данных.
 *
 * Этот скрипт выполняет удаление студента по переданному ID. 
 * Если пользователь не является администратором, он будет перенаправлен на страницу с ошибкой.
 * Если метод запроса не POST или отсутствует ID студента, то ничего не будет сделано.
 *
 * @throws Exception Если пользователь не является администратором.
 * @throws Exception Если ID студента не передан.
 */

// Подключаем необходимые файлы
require_once __DIR__ . '/../includes/auth.php'; // Для проверки роли пользователя
require_once __DIR__ . '/../db/education.php'; // Для работы с базой данных

// Проверка роли пользователя
if (!isAdmin()) {
    // Если пользователь не администратор, выводим ошибку и прекращаем выполнение
    die("⛔ Удаление доступно только администратору.");
}

// Проверка, что запрос был отправлен методом POST и что присутствует ID
if ($_SERVER['REQUEST_METHOD'] === 'POST' && isset($_POST['id'])) {
    /**
     * @var int $id ID студента, который будет удален.
     */
    $id = (int) $_POST['id']; // Преобразуем ID в целое число для предотвращения ошибок

    // Подготовка SQL-запроса для удаления студента с указанным ID
    $stmt = $eduPdo->prepare("DELETE FROM students WHERE id = ?");
    
    /**
     * Выполняем запрос, передавая ID студента для удаления.
     * Плейсхолдер "?" заменяется на значение $id.
     */
    $stmt->execute([$id]);
}

// После выполнения удаления перенаправляем на страницу со списком студентов
header('Location: ../pages/students.php');
exit;
